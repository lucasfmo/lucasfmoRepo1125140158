<properties
    pageTitle="Database Connectivity issue due to frozen VM detected"
    description="IsFronzenVM"
    infoBubbleText="最近の接続で問題が見つかりました。 右側の詳細を参照してください。"
    service="microsoft.sql"
    resource="servers"
    authors="hsuyiting"
    displayOrder=""
    articleId="IsFrozenVm_A4F4CB4A-E3C6-4001-B3D3-278FD7FC70EA"
    diagnosticScenario=""
    selfHelpType="rca"
    supportTopicIds=""
    resourceTags=""
    productPesIds=""
    cloudEnvironments="public"
/>
# <a name="we-ran-diagnostics-on-your-resource-and-found-an-issue"></a>お使いのリソースで診断が実行され、問題が見つかりました

<!--issueDescription-->
\\<!--$StartFreezeTime--> StartFreezeTime <!--$StartFreezeTime--> UTC ～ <!--$EndFreezeTime--> EndFreezeTime <!--$EndFreezeTime--> UTC の間に、VM フリーズの問題が発生したため、最近行われたデータベース **<!--$ServerName--> ServerName <!--/$ServerName-->** への接続試行が失敗しました。 軽減メカニズムが開始され、データベースが安定した状態に戻りました。 データベースが引き続き使用できない場合は、サポート チケットの作成に進んでください。
<!--/issueDescription-->

**影響の概要**<br>
Azure Virtual Machines により、SQL DB、Cosmos DB などの IaaS および PaaS サービスが強化されます。 今年 3 月頃、Azure では、新しい可用性低下カテゴリを 2 つ確認しました。<br>
  · 一部の仮想マシンが再起動される。<br>
  ·読み取り/書き込み操作がフリーズしているように見え、I/O がクロールする。<br>

当初、影響を受けるお客様はわずかでしたが (1 日約 0.01%)、10 月後半になり、低下した状態または再起動が発生したお客様の数が増えていることが認められました (1 日約 0.1%)。<br>

SQL DB または Cosmos DB をサポートする VM がこの状態になると、その VM にプライマリ レプリカがあるデータベースが使用できなくなります。 VM が再起動すると、Azure Service Fabric によって、新しいレプリカがプライマリとして特定され、利用不可の状態が短くなります。 ただし、VM の IO 操作がフリーズしていると、このフェールオーバーは行われません。 その場合、影響を受けるデータベースは、長時間にわたって利用不可のままになります。<br>

VM がなぜこの状態になるかについては、優先事項として調査しています。 チームは顧客データベースへの影響を防ぎ、根本原因を探り、修復措置を適用するための軽減策の特定に常に取り組んでいるため、この問題はもう発生していません。<br><br>

**根本原因の調査**<br>
この状態の VM からの情報と、再起動または I/O フリーズしたときの VM のテレメトリを分析中です。 これまでのところ Azure では、最近の ホスト OS の更新後に低下が始まり、これが 10 月後半からの突然の増加を引き起こしたと考えています。 更新が行われたとき、Azure には、この状態になった VM を把握するためのテレメトリがありませんでした。 Azure は問題の発生を軽減する修正プログラムをデプロイしました。 このロールアウトは、2017 年 12 月 14 日に完了しました。<br>

エンジニアは根本原因を特定するために、テレメトリ、ホストのダンプ、およびログを引き続き分析しています。 この問題を完全に解消するための修正プログラムは、まもなく提供できる予定です。<br><br>

**現在の軽減策**<br>
根本原因と修正プログラムが特定されるまでは、所定の軽減策の手順が実行されています。<br>
    1. ディスク コントローラー スタックの特定のアクションに関連して、ハードウェア レベルのシグナルが確認されています。 こうしたアクションが原因で、一部のコードパスからドライブが使用できなくなります。 発生後数秒以内にこのシグナルを検出し、フリーズした VM を自動的に再開するコードを現在デプロイ中です。 このシグナルは、誤検知 (現在約 25%) を最小限に抑えるために調整中です。 調整が完了したら、Azure 全体に段階的にデプロイがロールアウトされる予定です。<br>
    2. すべてのディスクでの読み取り/書き込み操作に対する定期的なチェックに基づいて、フリーズした操作を検出するシグナルも現在開発中です。 このシグナルでは、さらに低い誤検出率 (約 25%) で問題が検出されます。 ただし、検出と自動的なリスク軽減には 5 分かかります。 シグナルを検出するシステムは世界中の SQL DB VM にデプロイされ、現在調整中です。<br>
    3. Azure では、フリーズした VM をVM テレメトリの損失を通じて特定するメカニズム、またはVM が応答しなくなった状態を通信相手である他の VM の観点から 特定するメカニズムを開発しています。 このメカニズムの誤検出率は低く (約 10%)、検出漏れの率も高くありません (約 5%)。 ただし、検出と自動的なリスク軽減には 45 分かかります。 このシステムは、世界中の SQL および Cosmos DB にデプロイされます。<br><br>
Azure では、さらに多くのテレメトリを分析し、上記のシグナルを引き続き調整していきます。<br>
