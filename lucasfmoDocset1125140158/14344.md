---
title: "Сбор данных производительности приложений Linux в OMS Log Analytics | Документы Майкрософт"
description: "В этой статье предоставлены подробные сведения о настройке сбора счетчиков производительности для MySQL и HTTP-сервера Apache."
services: log-analytics
documentationcenter: 
author: mgoedtel
manager: carmonm
editor: tysonn
ms.assetid: f1d5bde4-6b86-4b8e-b5c1-3ecbaba76198
ms.service: log-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 05/04/2017
ms.author: magoedte
ms.openlocfilehash: 04ea6f728e59ec8b47e54fe45e1adc6cbbfb85ff
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="collect-performance-counters-for-linux-applications-in-log-analytics"></a>Сбор данных производительности приложений Linux в Log Analytics 
В этой статье предоставлены подробные сведения о настройке сбора счетчиков производительности для конкретных приложений для [агента OMS для Linux](https://github.com/Microsoft/OMS-Agent-for-Linux).  В статье используются следующие приложения:  

- [MySQL](#MySQL)
- [HTTP-сервер Apache](#apache-http-server)

## <a name="mysql"></a>MySQL
Если при установке агента OMS на компьютере обнаружен сервер MySQL или MariaDB, будет автоматически установлен поставщик мониторинга производительности для сервера MySQL. Этот поставщик подключается к локальному серверу MySQL или MariaDB, чтобы предоставить статистику производительности. Чтобы поставщик смог получить доступ к серверу MySQL, необходимо настроить учетные данные пользователя MySQL.

### <a name="configure-mysql-credentials"></a>Настройка учетных данных MySQL
Для получения сведений о производительности и состоянии от экземпляра MySQL необходимо предварительно настроить пользователя MySQL для поставщика OMI MySQL и установить клиентские библиотеки MySQL.  Эти учетные данные хранятся в файле проверки подлинности, размещенном на агенте Linux.  В файле проверки подлинности задаются адрес привязки и порт, которые прослушивает экземпляр MySQL, а также учетные данные, которые используются для сбора метрик.  

Во время установки агента OMS для Linux поставщик OMI MySQL проверит файлы конфигурации MySQL my.cnf (в расположении по умолчанию), чтобы определить адрес привязки и порт, и запишет некоторые параметры в файл проверки подлинности OMI MySQL.

Файл проверки подлинности MySQL находится в папке `/var/opt/microsoft/mysql-cimprov/auth/omsagent/mysql-auth`.


### <a name="authentication-file-format"></a>Формат файла аутентификации
Ниже описан формат файла проверки подлинности OMI MySQL

    [Port]=[Bind-Address], [username], [Base64 encoded Password]
    (Port)=(Bind-Address), (username), (Base64 encoded Password)
    (Port)=(Bind-Address), (username), (Base64 encoded Password)
    AutoUpdate=[true|false]

Параметры файла проверки подлинности описаны в следующей таблице.

| Свойство | ОПИСАНИЕ |
|:--|:--|
| Порт | Представляет текущий порт, который прослушивает экземпляр MySQL. Порт 0 означает, что для экземпляра по умолчанию используются следующие свойства. |
| адрес привязки;| Текущий адрес привязки MySQL. |
| Имя пользователя| Пользователь MySQL, который используется мониторинга экземпляра сервера MySQL. |
| пароль в кодировке Base64.| Пароль пользователя, который используется для мониторинга MySQL, в кодировке Base64. |
| Автоматическое обновление| Указывает, нужно ли повторно выполнять поиск изменений в файле my.cnf и перезаписывать файл проверки подлинности OMI MySQL при обновлении поставщика OMI MySQL. |

### <a name="default-instance"></a>Экземпляр по умолчанию
В файле проверки подлинности OMI MySQL можно определить экземпляр и номер порта по умолчанию. Это позволит удобнее управлять несколькими экземплярами MySQL на одном узле Linux.  В качестве экземпляра по умолчанию используется экземпляр с портом 0. Все дополнительные экземпляры наследуют свойства экземпляра по умолчанию, если для них не заданы другие значения этих свойств. Например, при добавлении экземпляра MySQL, который прослушивает порт 3308, для мониторинга этого экземпляра будет использоваться адрес привязки, имя пользователя и пароль в кодировке Base64 для экземпляра по умолчанию. Если экземпляр, который прослушивает порт 3308, привязан к другому адресу и использует те же имя пользователя и пароль MySQL, необходимо указать только адрес привязки. Остальные свойства будут унаследованы.

В следующей таблице приведены примеры параметров экземпляра 

| ОПИСАНИЕ | Файл |
|:--|:--|
| Экземпляр по умолчанию и экземпляр с портом 3308. | `0=127.0.0.1, myuser, cnBwdA==`<br>`3308=, ,`<br>`AutoUpdate=true` |
| Экземпляр по умолчанию и экземпляр с портом 3308 и другими именем пользователя и паролем. | `0=127.0.0.1, myuser, cnBwdA==`<br>`3308=127.0.1.1, myuser2,cGluaGVhZA==`<br>`AutoUpdate=true` |


### <a name="mysql-omi-authentication-file-program"></a>Программа для изменения файла проверки подлинности OMI MySQL
В состав поставщика OMI MySQL входит программа для изменения файла проверки подлинности OMI MySQL. Программа для изменения файла проверки подлинности находится в следующем каталоге.

    /opt/microsoft/mysql-cimprov/bin/mycimprovauth

> [!NOTE]
> Файл учетных данных должен быть доступен для чтения для учетной записи omsagent. Рекомендуется выполнить команду mycimprovauth, используя учетную запись omsgent.

В следующей таблице приведены сведения о синтаксисе mycimprovauth.

| Операция | Пример | ОПИСАНИЕ
|:--|:--|:--|
| autoupdate *false\|true* | mycimprovauth autoupdate false | Устанавливает, следует ли автоматически обновлять файл проверки подлинности при перезапуске или обновлении. |
| default *bind-address username password* | mycimprovauth default 127.0.0.1 root pwd | Задает экземпляр по умолчанию в файле проверки подлинности OMI MySQL.<br>Пароль в поле пароля следует вводить в формате обычного текста, так как в файле проверки подлинности OMI MySQL он будет зашифрован в кодировке Base 64. |
| delete *default\|port_num* | mycimprovauth 3308 | Удаляет указанный экземпляр по умолчанию или удаляет экземпляр по номеру порта. |
| help | mycimprov help | Выводит список используемых команд. |
| print | mycimprov print | Выводит содержимое файла проверки подлинности OMI MySQL в удобном формате. |
| update port_num *bind-address username password* | mycimprov update 3307 127.0.0.1 root pwd | Обновляет указанный экземпляр или добавляет экземпляр, если его не существует. |

С помощью команд в следующем примере определяется учетная запись пользователя по умолчанию для сервера MySQL на узле localhost.  Пароль в поле пароля следует вводить в формате обычного текста, так как в файле проверки подлинности OMI MySQL он будет зашифрован в кодировке Base 64.

    sudo su omsagent -c '/opt/microsoft/mysql-cimprov/bin/mycimprovauth default 127.0.0.1 <username> <password>'
    sudo /opt/omi/bin/service_control restart

### <a name="database-permissions-required-for-mysql-performance-counters"></a>Разрешения базы данных, необходимые для счетчиков производительности MySQL
Для сбора данных о производительности сервера MySQL у пользователя MySQL должен быть доступ к следующим запросам. 

    SHOW GLOBAL STATUS;
    SHOW GLOBAL VARIABLES:


Пользователю MySQL также необходим доступ с разрешением SELECT для следующих таблиц по умолчанию.

- information_schema;
- mysql. 

Эти привилегии можно предоставить, выполнив следующие команды:

    GRANT SELECT ON information_schema.* TO ‘monuser’@’localhost’;
    GRANT SELECT ON mysql.* TO ‘monuser’@’localhost’;


> [!NOTE]
> Чтобы предоставить разрешения пользователю мониторинга MySQL, у пользователя, предоставляющего разрешения, должна быть привилегия с параметром GRANT, а также предоставляемая привилегия.

### <a name="define-performance-counters"></a>Определение счетчиков производительности

После настройки отправки данных в Log Analytics для агента OMS для Linux необходимо настроить счетчики производительности для сбора данных.  Для счетчиков, описанных в следующей таблице, используйте процедуру, описанную в разделе [Источники данных о производительности Windows и Linux в Log Analytics](log-analytics-data-sources-windows-events.md).

| Имя объекта | Имя счетчика |
|:--|:--|
| База данных MySQL | Дисковое пространство в байтах |
| База данных MySQL | Таблицы |
| MySQL Server | Счетчик производительности "Прерванные подключения" |
| MySQL Server | Счетчик производительности "Использование подключения" |
| MySQL Server | Используемое дисковое пространство в байтах |
| MySQL Server | Счетчик производительности "Сканирование всей таблицы" |
| MySQL Server | Счетчик производительности "Попадания в буферный пул InnoDB" |
| MySQL Server | Счетчик производительности "Использование буферного пула InnoDB" |
| MySQL Server | Счетчик производительности "Использование буферного пула InnoDB" |
| MySQL Server | Счетчик производительности "Попадания в кэш ключей" |
| MySQL Server | Счетчик производительности "Использование кэша ключей" |
| MySQL Server | Счетчик производительности "Запись в кэш ключей" |
| MySQL Server | Счетчик производительности "Попадания в кэш запросов" |
| MySQL Server | Счетчик производительности "Очистка кэша запросов" |
| MySQL Server | Счетчик производительности "Использование кэша запросов" |
| MySQL Server | Счетчик производительности "Попадания в кэш таблиц" |
| MySQL Server | Счетчик производительности "Использование кэша таблиц" |
| MySQL Server | Счетчик производительности "Блокировка подключения к таблице" |

## <a name="apache-http-server"></a>HTTP-сервер Apache 
Если при установке пакета omsagent на компьютере обнаружен HTTP-сервер Apache, будет автоматически установлен поставщик мониторинга производительности для HTTP-сервера Apache. Для доступа к данным производительности этот поставщик использует модуль Apache, который необходимо загрузить на HTTP-сервер Apache. Этот модуль можно загрузить с помощью следующей команды:
```
sudo /opt/microsoft/apache-cimprov/bin/apache_config.sh -c
```

Чтобы выгрузить модуль мониторинга Apache, выполните следующую команду:
```
sudo /opt/microsoft/apache-cimprov/bin/apache_config.sh -u
```

### <a name="define-performance-counters"></a>Определение счетчиков производительности

После настройки отправки данных в Log Analytics для агента OMS для Linux необходимо настроить счетчики производительности для сбора данных.  Для счетчиков, описанных в следующей таблице, используйте процедуру, описанную в разделе [Источники данных о производительности Windows и Linux в Log Analytics](log-analytics-data-sources-windows-events.md).

| Имя объекта | Имя счетчика |
|:--|:--|
| HTTP-сервер Apache | Занятые рабочие роли |
| HTTP-сервер Apache | Бездействующие рабочие роли |
| HTTP-сервер Apache | Счетчик производительности "Занятые рабочие роли" |
| HTTP-сервер Apache | Счетчик производительности "Общее использование ЦП" |
| Виртуальный узел Apache | Ошибок в минуту (клиент) |
| Виртуальный узел Apache | Ошибок в минуту (сервер) |
| Виртуальный узел Apache | КБ на запрос |
| Виртуальный узел Apache | КБ в запросах в секунду |
| Виртуальный узел Apache | Запросов в секунду |



## <a name="next-steps"></a>Дополнительная информация
* [Сбор счетчиков производительности](log-analytics-data-sources-performance-counters.md) с агентов Linux.
* Узнайте больше об [операциях поиска по журналу](log-analytics-log-searches.md) , которые можно применять для анализа данных, собираемых из источников данных и решений. 
